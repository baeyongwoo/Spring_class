<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.rg/dtd/mybatis-3-mapper.dtd">
	<!-- 위의 스키마 작성 후, 어떤 인터페이스의 메서드를 쿼리문과
	연결해 줄지 아래와 같이 인터페이스 파일부터 mapper태그로 연결
	 -->
	 <mapper namespace="org.ict.mapper.BoardMapper">
	 
	 	<!-- 위의 BoardMapper 인터페이스의 getList메서드 호출시
	 	실제로 실행할 쿼리문을 아래와 같이 연결
	 	mybatis는 단일자료와 리스트자료를 구분하지 않기 때문에
	 	resultType에는 List<> 자료형도 아래와 같이
	 	단일 VO만 적어주면 됨
	 	 -->
	 	<select id="getList" resultType="org.ict.domain.BoardVO">
	 		<!-- <이나 >과 같이 태그로 오인될 수 있는 문자를 포함하는
	 		쿼리문은 그냥 작성하지 않고, CDATA를 이용
	 		<![CDATA[ 실행문 ]]> 과 같이 실행문을
	 		CDATA내부에 작성하면 내부의 부등호는 전부 문자로 간주  
	 		쿼리문에서 like절을 사용하는 경우 #{} 대신
	 		'%' || #{변수명} || '%' - oracle
	 		concat('%', #{변수명}, '%') - mysql
	 		-->
	 		<![CDATA[
	 		SELECT * FROM board_tbl WHERE lower(title) like '%'||#{keyword}||'%'order by bno desc
	 		]]>
	 	</select>
	 	
	 	<!-- insert 메서드 연결 -->
	 	<!-- 이 경우, VO 내부 변수를 #{변수명} 으로 쿼리문에 전달할 수 있음 
	 		${변수명}이 아님에 주의해주세요.
	 	-->
	 	<insert id="insert">
	 		INSERT INTO  board_tbl (bno, title, content, writer) values(board_num.nextval, #{title}, #{content}, #{writer}) 
	 	</insert>
	 	
	 	<!-- 위의 insert 메서드는 쿼리문을 한 번만 실행해도 데이터가 입력되지만
	 		단점이라면 bno에 들어갈 값을 미리 확인 할 수 없음
	 		bno에 들어갈 값을 확인할 수 있도록 insert실행 이전에
	 		bno값을 외부에서 조회할 수 있도록 변수화 시키는 작업이 필요
	 		그 작업을 할 때 사용하는 태그가 바로 selectKey 태그
	 	 -->
	 	<insert id="insertSelectKey">
	 		<!-- 실행 이전에 bno값을 먼저 조회해서 bno 변수명으로 저장 
	 			keyProperty에 변수명을, order에 BEFORE을 넣어서
	 			inesrt쿼리문 실행 이전에 조회한 bno값을 bno라는 명칭에 저장
	 		-->
	 		<selectKey keyProperty="bno" order="BEFORE"
	 			resultType="long">
	 			SELECT board_num.nextval from dual
	 			</selectKey>
	 			
			INSERT INTO  board_tbl (bno, title, content, writer) values(#{bno}, #{title}, #{content}, #{writer})	 			
	 	</insert>
	 	
	 	<select id="select" resultType="org.ict.domain.BoardVO">
	 		SELECT * FROM board_tbl WHERE bno = #{bno}
	 	</select>
	 	
	 	<delete id="delete">
	 		DELETE FROM board_tbl WHERE bno = #{bno}
	 	</delete>
	 	
	 	<update id="update">
	 		UPDATE board_tbl SET title= #{title}, content= #{content}, writer = #{writer}, updatedate = sysdate WHERE bno = #{bno}
	 	</update>
	 	
	 	
	 	
	 	<!--preparestatement을 대신으로 써야할 것 #{}, 물론 ${}도 사용가능하나, SQL injection 공격에 취약함  -->
	 </mapper>